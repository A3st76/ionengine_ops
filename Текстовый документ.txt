if (WIN32)
    set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS TRUE)
endif ()

add_library(platform SHARED
    "platform/windows/window.cpp"
    "platform/window.cpp"
)

target_precompile_headers(platform PRIVATE precompiled.h)

target_include_directories(platform PUBLIC
    "${PROJECT_SOURCE_DIR}"
)

target_link_directories(platform PUBLIC
)

target_link_libraries(platform PUBLIC
)

target_compile_definitions(platform PUBLIC 
    IONENGINE_PLATFORM_WIN32
)

add_library(engine SHARED
    "math/color.cpp"

    "rhi/dx12/rhi.cpp"
    "rhi/rhi.cpp"

    "engine/material.cpp"
    "engine/model.cpp"
    "engine/texture.cpp"
    "engine/shader.cpp"
    "engine/engine.cpp"
    "engine/linked_device.cpp"
    "engine/asset_loader.cpp"
    "engine/renderer.cpp"
    "engine/shader_manager.cpp"

    "extensions/importers/glb.cpp"
)

target_precompile_headers(engine PRIVATE precompiled.h)

target_include_directories(engine PUBLIC
    "${PROJECT_SOURCE_DIR}"
    "thirdparty/xxhash/include"
)

target_link_directories(engine PUBLIC
)

target_link_libraries(engine PUBLIC
    simdjson
    tinygltf
    png_static
    platform
    D3D12MemoryAllocator
)

target_compile_definitions(engine PUBLIC 
    IONENGINE_RHI_DIRECTX12
)

add_executable(project 
    "tests/main.cpp"
)

target_precompile_headers(project PRIVATE precompiled.h)

target_include_directories(project PRIVATE
    "${PROJECT_SOURCE_DIR}"
)

target_link_libraries(project PUBLIC
    engine
)

add_executable(shaderm 
    "tools/shaderm/main.cpp"
)

target_precompile_headers(shaderm PRIVATE precompiled.h)

target_include_directories(shaderm PRIVATE
    "${PROJECT_SOURCE_DIR}"
)

target_link_libraries(shaderm PUBLIC
    engine
    libwebview_edge_static
    base64pp
)